{"version":3,"sources":["../../src/tasks/import.js"],"names":["importTask","srcStream","scripts","versionVariant","dataType","DataType","String","value","version","pipe","ImportStream","then","versionNode","catch","err","statusCode","StatusCodes","BadNodeIdUnknown","name","description"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA;;;;AAIe,SAASA,UAAT,GAAsB;AACnC,QAAMC,SAAS,GAAG,eAAIC,sBAAJ,CAAlB;AACA,QAAMC,cAAc,GAAG;AAAEC,IAAAA,QAAQ,EAAEC,kBAASC,MAArB;AAA6BC,IAAAA,KAAK,EAAEC;AAApC,GAAvB;AAEA,SAAO,8BAAUP,SAAS,CACvBQ,IADc,CACT,IAAIC,qBAAJ,EADS,CAAV,EAGJC,IAHI,CAGC,MAAM,oBAAUC,oBAAV,EAAuBT,cAAvB,CAHP,EAIJU,KAJI,CAIEC,GAAG,IAAI;AACZ,QAAIA,GAAG,CAACC,UAAJ,KAAmBC,+BAAYC,gBAAnC,EAAqD;AACnD,aAAO,qBAAWL,oBAAX,EAAwB;AAC7BM,QAAAA,IAAI,EAAE,SADuB;AAE7BX,QAAAA,KAAK,EAAEJ;AAFsB,OAAxB,CAAP;AAID;;AAED,UAAMW,GAAN;AACD,GAbI,CAAP;AAcD;;AAEDd,UAAU,CAACmB,WAAX,GAAyB,kDAAzB","sourcesContent":["import { src } from 'gulp';\nimport scripts from '@atscm/server-scripts';\nimport { version } from '@atscm/server-scripts/package.json';\nimport toPromise from 'stream-to-promise';\nimport { DataType } from 'node-opcua/lib/datamodel/variant';\nimport { StatusCodes } from 'node-opcua/lib/datamodel/opcua_status_code';\nimport ImportStream from '../lib/gulp/ImportStream';\nimport { writeNode, createNode } from '../api';\nimport { versionNode } from '../lib/server/scripts/version';\n\n/**\n * Imports all xml files needed for atscm usage.\n * @return {Promise<void>} The running task.\n */\nexport default function importTask() {\n  const srcStream = src(scripts);\n  const versionVariant = { dataType: DataType.String, value: version };\n\n  return toPromise(srcStream\n    .pipe(new ImportStream())\n  )\n    .then(() => writeNode(versionNode, versionVariant))\n    .catch(err => {\n      if (err.statusCode === StatusCodes.BadNodeIdUnknown) {\n        return createNode(versionNode, {\n          name: 'version',\n          value: versionVariant,\n        });\n      }\n\n      throw err;\n    });\n}\n\nimportTask.description = 'Imports all xml resources needed for atscm usage';\n"],"file":"import.js"}