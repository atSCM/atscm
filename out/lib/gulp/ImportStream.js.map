{"version":3,"sources":["../../../src/lib/gulp/ImportStream.js"],"names":["scopeId","NodeIdType","NUMERIC","ImportStream","methodId","inputArguments","file","dataType","NodeId","value","XmlElement","contents","processErrorMessage","relative","handleOutputArguments","outputArguments","callback","importStatus","debug","Error"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;;;;AAIA,MAAMA,UAAU,qBAAW,iBAAOC,UAAP,CAAkBC,OAA7B,EAAsC,CAAtC,EAAyC,CAAzC,CAAhB;;AAEA;;;AAGe,MAAMC,YAAN,oCAA4C;;AAEzD;;;;AAIA,MAAIC,QAAJ,GAAe;AACb,WAAO,qBAAW,wCAAX,CAAP;AACD;;AAED;;;;;;;AAOAC,iBAAeC,IAAf,EAAqB;AACnB,WAAO,CACL;AACEC,gBAAU,kBAASC,MADrB;AAEEC,aAAOT;AAFT,KADK,EAKL;AACEO,gBAAU,kBAASG,UADrB;AAEED,aAAOH,KAAKK;AAFd,KALK,CAAP;AAUD;;AAED;;;;;AAKAC,sBAAoBN,IAApB,EAA0B;AACxB,WAAQ,yBAAwBA,KAAKO,QAAS,EAA9C;AACD;;AAED;;;;;;;AAOAC,wBAAsBR,IAAtB,EAA4BS,eAA5B,EAA6CC,QAA7C,EAAuD;AACrD,UAAM,CAACC,YAAD,IAAiBF,mBAAmB,CAAC,EAAD,CAA1C;;AAEA,QAAIE,aAAaR,KAAjB,EAAwB;AACtB,wBAAOS,KAAP,CAAc,+BAA8BZ,KAAKO,QAAS,EAA1D;;AAEAG,eAAS,IAAT;AACD,KAJD,MAIO;AACLA,eAAS,IAAIG,KAAJ,CAAU,eAAV,CAAT;AACD;AACF;;AAxDwD;kBAAtChB,Y","file":"ImportStream.js","sourcesContent":["import { DataType } from 'node-opcua/lib/datamodel/variant';\nimport Logger from 'gulplog';\nimport NodeId from '../model/opcua/NodeId';\nimport CallMethodStream from '../server/scripts/CallMethodStream';\n\n/**\n * The import operation's scope, which is set to be *absolute*.\n * @type {NodeId}\n */\nconst scopeId = new NodeId(NodeId.NodeIdType.NUMERIC, 0, 0);\n\n/**\n * A stream that imports xml files in parallel.\n */\nexport default class ImportStream extends CallMethodStream {\n\n  /**\n   * Id of the `importNodes` OPC-UA method.\n   * @type {NodeId}\n   */\n  get methodId() {\n    return new NodeId('ns=1;s=AGENT.OPCUA.METHODS.importNodes');\n  }\n\n  /**\n   * Returns the arguments the `importNodes` needs to be called with for the given file.\n   * @param {vinyl~File} file The file being processed.\n   * @return {node-opcua~Variant[]} The arguments for the `importNodes` method:\n   *  - The import scope (which is set to be absolute)\n   *  - The XML code (read from *file*)\n   */\n  inputArguments(file) {\n    return [\n      {\n        dataType: DataType.NodeId,\n        value: scopeId,\n      },\n      {\n        dataType: DataType.XmlElement,\n        value: file.contents,\n      },\n    ];\n  }\n\n  /**\n   * Returns an error message specifically for the given file.\n   * @param {vinyl~File} file The file to generate the error message for.\n   * @return {string} The specific error message.\n   */\n  processErrorMessage(file) {\n    return `Error importing file: ${file.relative}`;\n  }\n\n  /**\n   * Checks if the import succeeded and calls `callback` with an error otherwise.\n   * @param {vinyl~File} file The file that was processed.\n   * @param {?node-opcua~Variant[]} outputArguments The import status output arguments (Array with a\n   * single entry).\n   * @param {function(err: ?Error)} callback The callback called with an error if import failed.\n   */\n  handleOutputArguments(file, outputArguments, callback) {\n    const [importStatus] = outputArguments || [{}];\n\n    if (importStatus.value) {\n      Logger.debug(`Successfully imported file: ${file.relative}`);\n\n      callback(null);\n    } else {\n      callback(new Error('Import failed'));\n    }\n  }\n\n}\n"]}