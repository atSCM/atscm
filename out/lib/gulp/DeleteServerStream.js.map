{"version":3,"sources":["../../../src/lib/gulp/DeleteServerStream.js"],"names":["DeleteFsStream","constructor","options","deleteFileName","lineReader","createInterface","input","deleteNodeStream","printProgress","setInterval","info","processed","opsPerSecond","toFixed","listenerCount","cursorTo","process","stdout","moveCursor","on","line","nodeId","indexOf","split","trim","write","_flush","clearInterval","emit"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEA;;;AAGe,MAAMA,cAAN,CAAqB;;AAElC;;;;;AAKAC,cAAYC,UAAU,EAAtB,EAA0B;AACxB;;;;AAIA,UAAMC,iBAAiBD,QAAQC,cAAR,IAA0B,kBAAjD;;AAEA,UAAMC,aAAa,mBAASC,eAAT,CAAyB;AAC1CC,aAAO,0BAAiBH,cAAjB;AADmC,KAAzB,CAAnB;;AAIA,UAAMI,mBAAmB,gCAAzB;;AAEA,UAAMC,gBAAgBC,YAAY,MAAM;AACtC,wBAAOC,IAAP,CACG,YAAWH,iBAAiBI,SAAU,EADzC,EAEG,IAAGJ,iBAAiBK,YAAjB,CAA8BC,OAA9B,CAAsC,CAAtC,CAAyC,SAF/C;;AAKA,UAAI,kBAAOC,aAAP,CAAqB,MAArB,IAA+B,CAAnC,EAAsC;AACpC,2BAASC,QAAT,CAAkBC,QAAQC,MAA1B,EAAkC,CAAlC;AACA,2BAASC,UAAT,CAAoBF,QAAQC,MAA5B,EAAoC,CAApC,EAAuC,CAAC,CAAxC;AACD;AACF,KAVqB,EAUnB,IAVmB,CAAtB;;AAYAb,eAAWe,EAAX,CAAc,MAAd,EAAsBC,QAAQ;AAC5B,YAAMC,SAASD,KAAKE,OAAL,CAAa,SAAb,IAA0B,CAAC,CAA3B,GAA+B,qBAAWF,KAAKG,KAAL,CAAW,SAAX,EAAsB,CAAtB,EAAyBC,IAAzB,EAAX,CAA/B,GACb,qBAAWJ,KAAKI,IAAL,EAAX,CADF;;AAGAjB,uBAAiBkB,KAAjB,CAAuBJ,MAAvB;AACD,KALD;;AAQAd,qBAAiBY,EAAjB,CAAoB,SAApB,EAA+B,MAAM;AACnCZ,uBAAiBmB,MAAjB,CAAwB,MAAM;AAC5BC,sBAAcnB,aAAd;AACAD,yBAAiBqB,IAAjB,CAAsB,QAAtB;AACD,OAHD;AAID,KALD;;AAOA,WAAOrB,gBAAP;AACD;AAhDiC;kBAAfP,c","file":"DeleteServerStream.js","sourcesContent":["import readline from 'readline';\nimport Logger from 'gulplog';\nimport { createReadStream } from 'fs';\nimport DeleteNodeStream from '../delete/DeleteNodeStream';\nimport NodeId from '../ua/NodeId';\n\n/**\n * A stream that deletes listed nodes from atvise server\n */\nexport default class DeleteFsStream {\n\n  /**\n   * Creates a new DeleteServerStream based on the given options.\n   * @param {Object} options The stream configuration options.\n   * @param {String} [options.deleteFileName] The delete file name.\n   */\n  constructor(options = {}) {\n    /**\n     * The delete file name\n     * @type {String}\n     */\n    const deleteFileName = options.deleteFileName || 'deleteServer.txt';\n\n    const lineReader = readline.createInterface({\n      input: createReadStream(deleteFileName),\n    });\n\n    const deleteNodeStream = new DeleteNodeStream();\n\n    const printProgress = setInterval(() => {\n      Logger.info(\n        `Deleted: ${deleteNodeStream.processed}`,\n        `(${deleteNodeStream.opsPerSecond.toFixed(1)} ops/s)`\n      );\n\n      if (Logger.listenerCount('info') > 0) {\n        readline.cursorTo(process.stdout, 0);\n        readline.moveCursor(process.stdout, 0, -1);\n      }\n    }, 1000);\n\n    lineReader.on('line', line => {\n      const nodeId = line.indexOf('nodeId=') > -1 ? new NodeId(line.split('nodeId=')[1].trim()) :\n        new NodeId(line.trim());\n\n      deleteNodeStream.write(nodeId);\n    });\n\n\n    deleteNodeStream.on('drained', () => {\n      deleteNodeStream._flush(() => {\n        clearInterval(printProgress);\n        deleteNodeStream.emit('finish');\n      });\n    });\n\n    return deleteNodeStream;\n  }\n}\n"]}