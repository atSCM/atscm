{"version":3,"sources":["../../../../src/lib/model/opcua/NodeId.js"],"names":["Type","NodeIdType","TypeForIdentifier","i","NUMERIC","s","STRING","g","GUID","b","BYTESTRING","NodeId","constructor","typeOrValue","value","namespace","get","m","match","Number","isNaN","parseInt","n","t","v","fromFilePath","path","separator","split","reduce","result","current","next","filePath","parts","join","_lastSeparator","identifierType","indexOf","parent","substr","lastIndexOf","isChildOf","prefix","postfix","browseName","inspect","depth","options","stylize"],"mappings":"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","file":"NodeId.js","sourcesContent":["import { sep } from 'path';\nimport { NodeId as OpcNodeId } from 'node-opcua';\n\n/**\n * OPC-UA node id types.\n * @type {Map<String, node-opcua~NodeIdType>}\n */\nconst Type = OpcNodeId.NodeIdType;\n\n/**\n * OPC-UA node id types mapped against node-id identifiers (e.g. i, s ...).\n * @type {Map<String, node-opcua~NodeIdType>}\n */\nconst TypeForIdentifier = {\n  i: Type.NUMERIC,\n  s: Type.STRING,\n  g: Type.GUID,\n  b: Type.BYTESTRING,\n};\n\n/**\n * A wrapper around {@link node-opcua~NodeId}.\n */\nexport default class NodeId extends OpcNodeId {\n\n  /**\n   * Creates a new NodeId. Can be called in multiple ways:\n   *  - with a {@link node-opcua~NodeIdType}, a value and a namespace (defaults to 0),\n   *  - with a value only (type will be taken from it, namespace defaults to 1) or\n   *  - with a {@link NodeId}s string representation (for example `ns=1;s=AGENT.DISPLAYS`).\n   * @param {node-opcua~NodeIdType|String|Number} typeOrValue The type or value to use.\n   * @param {(Number|String)} [value] The value to use.\n   * @param {number} [namespace=1] The namespace to use.\n   */\n  constructor(typeOrValue, value, namespace = 1) {\n    if (!(Type.get(typeOrValue))) {\n      let m = null;\n\n      if (typeof typeOrValue === 'string') {\n        m = typeOrValue.match(/^ns=([0-9]+);(i|s|g|b)=(.*)$/);\n      }\n\n      if (m === null) {\n        super(\n          Number.isNaN(Number.parseInt(typeOrValue, 10)) ? Type.STRING : Type.NUMERIC,\n          typeOrValue,\n          1\n        );\n      } else {\n        const n = Number.parseInt(m[1], 10);\n        const t = TypeForIdentifier[m[2]];\n        const v = t === Type.NUMERIC ? Number.parseInt(m[3], 10) : m[3];\n\n        super(t, v, n);\n      }\n    } else {\n      super(typeOrValue, value, namespace);\n    }\n  }\n\n  /**\n   * Creates a new NodeId based on a file path.\n   * @param {string} path The file path to use.\n   * @return {NodeId} The resulting NodeId.\n   */\n  static fromFilePath(path) {\n    let separator = '.';\n    const value = path.split(sep)\n      .reduce((result, current) => {\n        const next = `${result}${separator}${current}`;\n\n        if (current === 'RESOURCES') {\n          separator = '/';\n        }\n\n        return next;\n      });\n\n    return new NodeId(NodeId.NodeIdType.STRING, value, 1);\n  }\n\n  /**\n   * The node id's value, encoded to a file path.\n   * @type {string}\n   */\n  get filePath() {\n    const parts = this.value.split('RESOURCES');\n    parts[0] = parts[0].split('.').join('/');\n\n    return parts.join('RESOURCES');\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Returns the last separator in a string node id's path, e.g.:\n   * - `'/'` for `ns=1;SYSTEM.LIBRARY.RESOURCES/index.htm`,\n   * - `'.'` for `ns=1;AGENT.DISPLAYS.Main`.\n   * @type {?string} `null` for non-string node ids, `'/'` for resource paths, `'.'` for regular\n   * string node ids.\n   */\n  get _lastSeparator() {\n    if (this.identifierType !== NodeId.NodeIdType.STRING) {\n      return null;\n    }\n\n    return ~(this.value.indexOf('/')) ? '/' : '.';\n  }\n\n  /**\n   * The parent node id, or `null`.\n   * @type {?NodeId}\n   */\n  get parent() {\n    if (this.identifierType !== NodeId.NodeIdType.STRING) {\n      return null;\n    }\n\n    return new NodeId(\n      NodeId.NodeIdType.STRING,\n      this.value.substr(0, this.value.lastIndexOf(this._lastSeparator)),\n      this.namespace\n    );\n  }\n\n  /**\n   * Checks if the node is a child of another.\n   * @param {NodeId} parent The possible parent to check.\n   * @return {boolean} `true` if *this* is a child node of *parent*.\n   */\n  isChildOf(parent) {\n    if (this.identifierType !== NodeId.NodeIdType.STRING ||\n      parent.identifierType !== NodeId.NodeIdType.STRING) {\n      return false;\n    }\n\n    if (this.namespace !== parent.namespace || this.value === parent.value) {\n      return false;\n    }\n\n    const [prefix, postfix] = this.value.split(parent.value);\n\n    return (prefix === '' && postfix && postfix[0] === this._lastSeparator);\n  }\n\n  /**\n   * The node id's browsename as string.\n   * @type {string}\n   */\n  get browseName() {\n    if (this.identifierType !== NodeId.NodeIdType.STRING) {\n      return null;\n    }\n\n    return this.value.substr(this.value.lastIndexOf(this._lastSeparator) + 1);\n  }\n\n  /**\n   * Returns a string in the format \"namespace value\" that is printed when inspecting the NodeId\n   * using {@link util~inspect}.\n   * @see https://nodejs.org/api/util.html#util_util_inspect_object_options\n   * @param {number} depth The depth to inspect.\n   * @param {Object} options The options to use.\n   * @return {string} A string in the format \"namespace value\".\n   */\n  inspect(depth, options) {\n    return [\n      options.stylize(this.namespace, 'number'),\n      options.stylize(this.value, this.identifierType === Type.NUMERIC ? 'number' : 'string'),\n    ].join(' ');\n  }\n\n}\n"]}