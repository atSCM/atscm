{"version":3,"sources":["../../../src/lib/helpers/tasks.js"],"names":["handleTaskError","error","location","rawLines","originalStack","stack","message","additionalMessage","node","nodeId","Object","assign","finishTask","Session","closeOpen"],"mappings":";;;;;;;;AAAA;;AACA;;;;AAEA;;;;;AAKO,SAASA,eAAT,CAAyBC,KAAzB,EAAgC;AACrC,MAAIA,KAAK,CAACC,QAAN,IAAkBD,KAAK,CAACE,QAA5B,EAAsC;AACpCF,IAAAA,KAAK,CAACG,aAAN,GAAsBH,KAAK,CAACI,KAA5B,CADoC,CACD;AACnC;;AACAJ,IAAAA,KAAK,CAACI,KAAN,GAAe,GAAEJ,KAAK,CAACK,OAAQ;EACjC,iCAAiBL,KAAK,CAACE,QAAvB,EAAiCF,KAAK,CAACC,QAAvC,EAAiD;AAAEI,MAAAA,OAAO,EAAEL,KAAK,CAACK;AAAjB,KAAjD,CAA6E,EAD3E;AAED;;AAED,QAAMC,iBAAiB,GAAGN,KAAK,CAACO,IAAN,GAAc;WAC/BP,KAAK,CAACO,IAAN,CAAWC,MAAO,EADD,GACK,EAD/B;AAGAC,EAAAA,MAAM,CAACC,MAAP,CAAcV,KAAd,EAAqB;AACnBK,IAAAA,OAAO,EAAG,GAAEL,KAAK,CAACK,OAAQ,GAAEC,iBAAkB,EAD3B;AAEnBF,IAAAA,KAAK,EAAG,GAAEJ,KAAK,CAACI,KAAM,GAAEE,iBAAkB;AAFvB,GAArB;AAKA,QAAMN,KAAN;AACD;AAED;;;;;;AAIO,SAASW,UAAT,GAAsB;AAC3B,SAAOC,iBAAQC,SAAR,EAAP;AACD","sourcesContent":["import { codeFrameColumns } from '@babel/code-frame';\nimport Session from '../server/Session';\n\n/**\n * Adds additional infomation to the error's message and rethows it.\n * @param {Error} error The error that occured.\n * @throws {Error} The extended error.\n */\nexport function handleTaskError(error) {\n  if (error.location && error.rawLines) {\n    error.originalStack = error.stack; // eslint-disable-line no-param-reassign\n    // eslint-disable-next-line no-param-reassign\n    error.stack = `${error.message}\n${codeFrameColumns(error.rawLines, error.location, { message: error.message })}`;\n  }\n\n  const additionalMessage = error.node ? `\n - Node: ${error.node.nodeId}` : '';\n\n  Object.assign(error, {\n    message: `${error.message}${additionalMessage}`,\n    stack: `${error.stack}${additionalMessage}`,\n  });\n\n  throw error;\n}\n\n/**\n * Closes open sessions once a task is complete.\n * @return {Promise<void>} Resolved once cleanup is complete.\n */\nexport function finishTask() {\n  return Session.closeOpen();\n}\n"],"file":"tasks.js"}