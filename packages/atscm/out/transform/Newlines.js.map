{"version":3,"sources":["../../src/transform/Newlines.js"],"names":["trailingNewlineRegExp","NewlinesTransformer","PartialTransformer","constructor","options","_addTrailingNewlines","trailingNewlines","shouldBeTransformed","file","stem","dataType","DataType","ByteString","transformFromDB","enc","callback","str","contents","toString","replace","EOL","match","Buffer","from","transformFromFilesystem","transformsReferenceConfigFiles"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA;;;AAGA,MAAMA,qBAAqB,GAAG,QAA9B;AAEA;;;;;;AAKe,MAAMC,mBAAN,SAAkCC,2BAAlC,CAAqD;AAClE;;;;;;AAMAC,EAAAA,WAAW,CAACC,OAAO,GAAG,EAAX,EAAe;AACxB,UAAMA,OAAN;AAEA;;;;;AAIA,SAAKC,oBAAL,GAA4BD,OAAO,CAACE,gBAAR,IAA4B,KAAxD;AACD;AAED;;;;;;;AAKAC,EAAAA,mBAAmB,CAACC,IAAD,EAAO;AACxB,WAAOA,IAAI,CAACC,IAAL,CAAU,CAAV,MAAiB,GAAjB,IAAwBD,IAAI,CAACE,QAAL,KAAkBC,kBAASC,UAA1D;AACD;AAED;;;;;;;;AAMAC,EAAAA,eAAe,CAACL,IAAD,EAAOM,GAAP,EAAYC,QAAZ,EAAsB;AACnC,QAAIC,GAAG,GAAGR,IAAI,CAACS,QAAL,CAAcC,QAAd,GAAyBC,OAAzB,CAAiC,QAAjC,EAA2CC,OAA3C,CAAV;;AAEA,QAAI,KAAKf,oBAAL,IAA6B,CAACW,GAAG,CAACK,KAAJ,CAAUrB,qBAAV,CAAlC,EAAoE;AAClEgB,MAAAA,GAAG,IAAII,OAAP;AACD;;AAEDZ,IAAAA,IAAI,CAACS,QAAL,GAAgBK,MAAM,CAACC,IAAP,CAAYP,GAAZ,CAAhB,CAPmC,CAOD;;AAElCD,IAAAA,QAAQ,CAAC,IAAD,EAAOP,IAAP,CAAR;AACD;AAED;;;;;;;;AAMAgB,EAAAA,uBAAuB,CAAChB,IAAD,EAAOM,GAAP,EAAYC,QAAZ,EAAsB;AAC3C,QAAIC,GAAG,GAAGR,IAAI,CAACS,QAAL,CAAcC,QAAd,GAAyBC,OAAzB,CAAiC,QAAjC,EAA2C,MAA3C,CAAV;;AAEA,QAAI,KAAKd,oBAAT,EAA+B;AAC7BW,MAAAA,GAAG,GAAGA,GAAG,CAACG,OAAJ,CAAYnB,qBAAZ,EAAmC,EAAnC,CAAN;AACD;;AAEDQ,IAAAA,IAAI,CAACS,QAAL,GAAgBK,MAAM,CAACC,IAAP,CAAYP,GAAZ,CAAhB,CAP2C,CAOT;;AAElCD,IAAAA,QAAQ,CAAC,IAAD,EAAOP,IAAP,CAAR;AACD;AAED;;;;;;AAIA,MAAIiB,8BAAJ,GAAqC;AACnC,WAAO,IAAP;AACD;;AApEiE","sourcesContent":["import { EOL } from 'os';\nimport { DataType } from 'node-opcua/lib/datamodel/variant';\nimport PartialTransformer from '../lib/transform/PartialTransformer';\n\n/**\n * A regular expression matching trailing newlines.\n */\nconst trailingNewlineRegExp = /\\r?\\n$/;\n\n/**\n * A transformer that handles newline characters in files. During a pull, all breaks are converted\n * the OS-native EOL character and (optionally) a trailing newline is added (for better git diffs).\n * On push, CRLF characters are used and those trailing newlines are removed again.\n */\nexport default class NewlinesTransformer extends PartialTransformer {\n  /**\n   * Creates a new newline transformer.\n   * @param {Object} [options={}] The options to use.\n   * @param {boolean} [options.trailingNewlines] If trailing newlines should be added. Pass *true*\n   * for better git diffs.\n   */\n  constructor(options = {}) {\n    super(options);\n\n    /**\n     * If newlines should be added to pulled files.\n     * @type {boolean}\n     */\n    this._addTrailingNewlines = options.trailingNewlines || false;\n  }\n\n  /**\n   * Returns `true` for all files except binary ones.\n   * @param {AtviseFile} file The file being transformed.\n   * @return {boolean} Always `true`.\n   */\n  shouldBeTransformed(file) {\n    return file.stem[0] === '.' || file.dataType !== DataType.ByteString;\n  }\n\n  /**\n   * Adds converts line breaks to the current OS's native EOL characters and adds trailing newlines.\n   * @param {AtviseFile} file The file being transformed.\n   * @param {string} enc The encoding used.\n   * @param {function(err: ?Error, data: ?AtviseFile)} callback Called with the corrected file.\n   */\n  transformFromDB(file, enc, callback) {\n    let str = file.contents.toString().replace(/\\r?\\n/g, EOL);\n\n    if (this._addTrailingNewlines && !str.match(trailingNewlineRegExp)) {\n      str += EOL;\n    }\n\n    file.contents = Buffer.from(str); // eslint-disable-line no-param-reassign\n\n    callback(null, file);\n  }\n\n  /**\n   * Removes trailing newlines and converts all breaks to CRLF.\n   * @param {AtviseFile} file The file being transformed.\n   * @param {string} enc The encoding used.\n   * @param {function(err: ?Error, data: ?AtviseFile)} callback Called with resulting file.\n   */\n  transformFromFilesystem(file, enc, callback) {\n    let str = file.contents.toString().replace(/\\r?\\n/g, '\\r\\n');\n\n    if (this._addTrailingNewlines) {\n      str = str.replace(trailingNewlineRegExp, '');\n    }\n\n    file.contents = Buffer.from(str); // eslint-disable-line no-param-reassign\n\n    callback(null, file);\n  }\n\n  /**\n   * `true` because we want to transform all files.\n   * @type {boolean}\n   */\n  get transformsReferenceConfigFiles() {\n    return true;\n  }\n}\n"],"file":"Newlines.js"}